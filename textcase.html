<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TextCase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Mona+Sans:ital,opsz,wght@0,8..36,100..1000;1,8..36,100..1000&display=swap"
    rel="stylesheet">
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Mona Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    textarea {
      resize: none;
      outline: none;
      border: none;
      background: transparent;
      padding: clamp(2rem, 8vw, 8rem) clamp(2rem, 10vw, 8rem);
      font-size: clamp(1.5rem, 6vw, 3.5rem);
      line-height: 1.6;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
  </style>
</head>

<body class="bg-white flex flex-col min-h-screen">

  <!-- Main Header -->
  <header class="bg-black text-white p-5 text-center shadow-lg flex justify-between items-center">
    <a href="textcase.html" class="text-4xl font-extrabold tracking-tight">TextCase</a>
    <div class="flex flex-wrap gap-6 text-base font-medium text-white">
      <span><strong class="text-gray-100 mr-1" id="charCount">0</strong> Characters</span>
      <span><strong class="text-gray-100 mr-1" id="wordCount">0</strong> Words</span>
      <span><strong class="text-gray-100 mr-1" id="sentenceCount">0</strong> Sentences</span>
      <span><strong class="text-gray-100 mr-1" id="lineCount">1</strong> Lines</span>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-1 relative">
    <textarea id="textArea"
      class="absolute inset-0 w-full h-full text-black placeholder-gray-300 font-medium p-6 text-xl"
      placeholder="Start typing here..."></textarea>

    <button onclick="copyToClipboard()"
      class="absolute top-4 sm:top-6 md:top-8 right-4 sm:right-6 md:right-8 px-5 py-3 bg-black text-white rounded-xl hover:bg-gray-800 transition shadow-xl z-10 font-semibold">
      Copy
    </button>
  </div>

  <!-- Action Buttons -->
  <div class="bg-white border-t border-gray-200 px-4 sm:px-6 md:px-8 py-5 flex-shrink-0">
    <div class="flex flex-wrap justify-center gap-3">
      <button onclick="toUpper()"
        class="px-5 py-3 bg-black text-white font-medium rounded-xl hover:bg-gray-800 transition text-sm">UPPERCASE</button>
      <button onclick="toLower()"
        class="px-5 py-3 bg-black text-white font-medium rounded-xl hover:bg-gray-800 transition text-sm">lowercase</button>
      <button onclick="toCapitalized()"
        class="px-5 py-3 bg-black text-white font-medium rounded-xl hover:bg-gray-800 transition text-sm">Capitalized
        Case</button>
      <button onclick="toTitle()"
        class="px-5 py-3 bg-black text-white font-medium rounded-xl hover:bg-gray-800 transition text-sm">Title
        Case</button>
      <button onclick="toSentence()"
        class="px-5 py-3 bg-black text-white font-medium rounded-xl hover:bg-gray-800 transition text-sm">Sentence
        case</button>
      <button onclick="addLoremParagraph()"
        class="px-5 py-3 bg-black text-white font-medium rounded-xl hover:bg-gray-800 transition text-sm">Add Lorem
        Ipsum</button>
      <button onclick="clearText()"
        class="px-5 py-3 bg-gray-600 text-white font-medium rounded-xl hover:bg-gray-700 transition text-sm">Clear</button>
    </div>
  </div>

  <script>
    const textArea = document.getElementById('textArea');
    const charCountEl = document.getElementById('charCount');
    const wordCountEl = document.getElementById('wordCount');
    const sentenceCountEl = document.getElementById('sentenceCount');
    const lineCountEl = document.getElementById('lineCount');

    const STORAGE_KEY = 'caseConverterText';
    const EXPIRY_KEY = 'caseConverterExpiry';

    // Save to localStorage with 24h expiry
    function saveToStorage() {
      const expiry = Date.now() + 24 * 60 * 60 * 1000;
      localStorage.setItem(STORAGE_KEY, textArea.value);
      localStorage.setItem(EXPIRY_KEY, expiry);
    }

    function loadFromStorage() {
      const saved = localStorage.getItem(STORAGE_KEY);
      const expiry = localStorage.getItem(EXPIRY_KEY);
      if (saved !== null && expiry && Date.now() < parseInt(expiry)) {
        textArea.value = saved;
        updateStats();
      } else {
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(EXPIRY_KEY);
      }
    }

    // Update all counters
    function updateStats() {
      const text = textArea.value;

      // Characters (including spaces)
      const chars = text.length;
      charCountEl.textContent = chars;

      // Words (split on whitespace, filter empty)
      const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      wordCountEl.textContent = words;

      // Sentences (based on . ! ? followed by space/capital or end)
      const sentences = text.trim() === '' ? 0 : (text.match(/[.!?]+[\s\n]+[A-Z]|[.!?]+$/g) || []).length +
        (text.match(/^[A-Z].*[.!?]$/m) || []).length;
      // Fallback: count terminators if above fails
      const fallbackSentences = text.trim() === '' ? 0 : (text.match(/[.!?]/g) || []).length;
      sentenceCountEl.textContent = sentences > 0 ? sentences : (fallbackSentences > 0 ? fallbackSentences : (text.trim() ? 1 : 0));

      // Lines (including last line even if no trailing \n)
      const lines = text.split('\n').length || 1;
      lineCountEl.textContent = lines;
    }

    // Case conversion functions
    function toUpper() { textArea.value = textArea.value.toUpperCase(); updateStats(); saveToStorage(); textArea.focus(); }
    function toLower() { textArea.value = textArea.value.toLowerCase(); updateStats(); saveToStorage(); textArea.focus(); }
    function toCapitalized() {
      textArea.value = textArea.value.toLowerCase().replace(/(^|\s)\w/g, l => l.toUpperCase());
      updateStats(); saveToStorage(); textArea.focus();
    }
    function toTitle() { toCapitalized(); }
    function toSentence() {
      textArea.value = textArea.value.toLowerCase().replace(/(^\s*\w|[\.\!\?]\s*\w)/g, l => l.toUpperCase());
      updateStats(); saveToStorage(); textArea.focus();
    }
    function clearText() { textArea.value = ''; updateStats(); saveToStorage(); textArea.focus(); }

    async function addLoremParagraph() {
      try {
        const response = await fetch('https://baconipsum.com/api/?type=meat-and-filler&paras=1&format=text&start-with-lorem=1');
        if (!response.ok) throw new Error('Failed');
        let paragraph = await response.text();
        paragraph = paragraph.trim();

        const separator = textArea.value && !textArea.value.endsWith('\n\n') ? '\n\n' : '';
        textArea.value += separator + paragraph;
        updateStats();
        saveToStorage();
        textArea.focus();
        textArea.scrollTop = textArea.scrollHeight;
      } catch (error) {
        const fallback = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.';
        const separator = textArea.value && !textArea.value.endsWith('\n\n') ? '\n\n' : '';
        textArea.value += separator + fallback;
        updateStats();
        saveToStorage();
        textArea.focus();
        textArea.scrollTop = textArea.scrollHeight;
      }
    }

    function copyToClipboard() {
      textArea.select();
      document.execCommand('copy');
      const btn = event.target;
      const orig = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = orig, 2000);
    }

    // Event Listeners
    textArea.addEventListener('input', () => {
      saveToStorage();
      updateStats();
    });

    window.addEventListener('load', () => {
      loadFromStorage();
      textArea.focus();
    });
  </script>
</body>

</html>